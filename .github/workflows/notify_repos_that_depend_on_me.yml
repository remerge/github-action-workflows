name: Notify repos that depend on me

on:
  workflow_call:
    inputs:
      dependants:
        type: string
        required: true
        description: "String containing a JSON list (because we can't pass a list as an input)"
    secrets:
      pat_for_updating:
        description: "Need a PAT with update permissions to send events to a repo"
        required: true

jobs:
  notify-all-dependants:
    strategy:
      matrix:
        dependant: ${{ fromJSON(inputs.dependants) }}
    runs-on: ubuntu-latest
    steps:
    - run: echo ${{ matrix.dependant }}
      shell: bash

    - name: Dispatch Event
      uses: peter-evans/repository-dispatch@v2
      with:
        token: ${{ secrets.pat_for_updating }}
        repository: remerge/${{ matrix.dependant }}
        event-type: new-main-commit
        client-payload: |
          {
            "repo_path": "github.com/${{ github.repository }}",
            "repo_name": "${{ github.repository }}"
          }
